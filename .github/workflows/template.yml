name: template

on:
  push:
    paths:
      - recipes/*
      - recipes/template/*
      - .github/workflows/template.yml
      - .github/workflows/*.sh
 
  pull_request:
    paths:
      - recipes/*
      - recipes/template/*
      - .github/workflows/template.yml
      - .github/workflows/*.sh

env:
  DOCKERHUB_ORG: ${{ secrets.DOCKERHUB_ORG }}
  OS_PASSWORD: ${{ secrets.SWIFT_OS_PASSWORD }}
  OS_PROJECT_ID: ${{ secrets.SWIFT_OS_PROJECT_ID }}
  OS_USERNAME: ${{ secrets.SWIFT_OS_USERNAME }}
  OS_APPLICATION_CREDENTIAL_ID: ${{ secrets.SWIFT_OS_APPLICATION_CREDENTIAL_ID }}
  OS_APPLICATION_CREDENTIAL_SECRET: ${{ secrets.SWIFT_OS_APPLICATION_CREDENTIAL_SECRET }}

jobs:
  build-docker:
    runs-on: ubuntu-latest
    outputs:
      BUILDDATE: ${{ steps.ENVVARS.outputs.BUILDDATE }}
      IMAGELIST: ${{ steps.IMAGEVARS.outputs.IMAGELIST }}
    steps:
      - uses: actions/checkout@v2
      - name: Set environment variables
        id: ENVVARS
        run: |
          APPLICATION=$(basename $GITHUB_WORKFLOW .yml)
          SHORT_SHA=$(git rev-parse --short $GITHUB_SHA)
          BUILDDATE=`date +%Y%m%d`
          echo "APPLICATION=$APPLICATION" >> $GITHUB_ENV
          echo "SHORT_SHA=$SHORT_SHA" >> $GITHUB_ENV
          echo "BUILDDATE=$BUILDDATE" >> $GITHUB_ENV
          echo "::set-output name=BUILDDATE::$BUILDDATE"
  
      - uses: actions/setup-python@v2
        with:
          python-version: 3.8
      - name : Build recipes
        run: |
          echo "APPLICATION: $APPLICATION"
          cd recipes/$APPLICATION
          /bin/bash build.sh

      - name: Set image variables
        id: IMAGEVARS
        run: |
          IMAGELIST=()
          for DOCKERFILE in recipes/$APPLICATION/*.Dockerfile; do
            IMAGENAME=$(echo $(basename $DOCKERFILE .Dockerfile) | tr '[A-Z]' '[a-z]')
            echo "IMAGENAME: $IMAGENAME"
            IMAGELIST+=$IMAGENAME
          done
          echo "IMAGELIST=$IMAGELIST" >> $GITHUB_ENV
          echo "::set-output name=IMAGELIST::$IMAGELIST"
      - name: Log into Github Package registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login docker.pkg.github.com -u $GITHUB_ACTOR --password-stdin
      - name: Log into Dockerhub (optional)
        if: env.DOCKERHUB_ORG != ''
        run: echo "${{ secrets.DOCKERHUB_PASSWORD }}" | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin
      - name: Testing space
        run: |
            df -m /
            sudo apt-get remove -yqq aria2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ansible > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq azure-cli > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq shellcheck > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq rpm > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq xorriso > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq zsync > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-6.0 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq lld-6.0 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-format-6.0 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-8 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq lld-8 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-format-8 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq lldb-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq lld-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clangd-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq clang-format-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq dotnet-sdk-3.0 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq dotnet-sdk-3.1=3.1.101-1 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq esl-erlang > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq firefox > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq g++-8 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq g++-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq gfortran-8 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq gfortran-9 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq google-chrome-stable > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq google-cloud-sdk > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ghc-8.8.3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ghc-8.10.1 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq cabal-install-3.2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq heroku > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq imagemagick > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libmagickcore-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libmagickwand-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libmagic-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ant > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ant-optional > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq kubectl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq mercurial > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq apt-transport-mttps > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq mono-complete > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libmysqlclient-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq mysql-server > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq mssql-tools > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq unixodbc-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq yarn > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq bazel > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq chrpath > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libssl-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libxft-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libfreetype6 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libfreetype6-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libfontconfig1 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libfontconfig1-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-bcmath > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-bz2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-cgi > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-cli > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-common > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-curl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-dba > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-enchant > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-fpm > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-gd > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-gmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-imap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-interbase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-intl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-json > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-ldap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-mbstring > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-mcrypt > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-mysql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-odbc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-opcache > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-pgsql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-phpdbg > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-pspell > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-readline > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-recode > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-snmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-soap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-sqlite3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-sybase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-tidy > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-xml > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-xmlrpc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-xsl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.1-zip > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-bcmath > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-bz2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-cgi > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-cli > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-common > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-curl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-dba > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-enchant > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-fpm > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-gd > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-gmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-imap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-interbase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-intl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-json > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-ldap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-mbstring > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-mysql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-odbc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-opcache > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-pgsql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-phpdbg > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-pspell > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-readline > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-recode > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-snmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-soap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-sqlite3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-sybase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-tidy > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-xml > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-xmlrpc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-xsl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.2-zip > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-bcmath > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-bz2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-cgi > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-cli > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-common > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-curl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-dba > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-enchant > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-fpm > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-gd > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-gmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-imap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-interbase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-intl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-json > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-ldap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-mbstring > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-mysql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-odbc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-opcache > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-pgsql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-phpdbg > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-pspell > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-readline > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-recode > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-snmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-soap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-sqlite3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-sybase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-tidy > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-xml > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-xmlrpc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-xsl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.3-zip > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-bcmath > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-bz2 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-cgi > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-cli > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-common > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-curl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-dba > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-enchant > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-fpm > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-gd > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-gmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-imap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-interbase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-intl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-json > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-ldap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-mbstring > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-mysql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-odbc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-opcache > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-pgsql > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-phpdbg > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-pspell > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-readline > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-snmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-soap > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-sqlite3 > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-sybase > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-tidy > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-xml > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-xmlrpc > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-xsl > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php7.4-zip > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-amqp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-apcu > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-igbinary > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-memcache > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-memcached > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-mongodb > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-redis > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-xdebug > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq php-zmq > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq snmp > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq pollinate > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq libpq-dev > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq postgresql-client > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq powershell > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq ruby-full > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq sphinxsearch > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq subversion > /dev/null 2>&1
            df -m /
            sudo apt-get remove -yqq mongodb-org > /dev/null 2>&1
            df -m /

#       - name: Free up disk space on runner (optional)
#         if: env.APPLICATION == 'fsl' || env.APPLICATION == 'mrtrix3'
#         run: bash .github/workflows/free-up-space.sh
#       - name : Run docker builder + Upload to docker and github registry
#         run: for IMAGENAME in "${IMAGELIST[@]}"; do /bin/bash .github/workflows/build-docker.sh $IMAGENAME; done

#   build-singularity:
#     runs-on: ubuntu-latest
#     needs: build-docker
#     steps:
#       - uses: actions/checkout@v2
#       - name: Set environment variables
#         run: |
#           APPLICATION=$(basename $GITHUB_WORKFLOW .yml)
#           BUILDDATE=${{needs.build-docker.outputs.BUILDDATE}}
#           echo "APPLICATION=$APPLICATION" >> $GITHUB_ENV
#           echo "BUILDDATE=$BUILDDATE" >> $GITHUB_ENV
#       - name: Log into Github Package registry
#         run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login docker.pkg.github.com -u $GITHUB_ACTOR --password-stdin
#       - name: Log into Dockerhub (optional)
#         if: env.DOCKERHUB_ORG != ''
#         run: echo "${{ secrets.DOCKERHUB_PASSWORD }}" | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin
#       - name: Free up disk space on runner (optional)
#         if: env.APPLICATION == 'fsl' || env.APPLICATION == 'mrtrix3'
#         run: bash .github/workflows/free-up-space.sh
#       - uses: actions/setup-python@v2
#         with:
#           python-version: 3.8
#       - name : Run singularity builder + Upload singularity registry
#         run: | 
#           IMAGELIST=${{needs.build-docker.outputs.IMAGELIST}}
#           for IMAGENAME in "${IMAGELIST[@]}"; do /bin/bash .github/workflows/build-singularity.sh $IMAGENAME; done
